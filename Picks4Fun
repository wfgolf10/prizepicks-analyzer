prizepicks-app/
 ‚îú‚îÄ‚îÄ prizepicks_predictor.py   # your ML logic (refactored to expose run_pipeline)
 ‚îú‚îÄ‚îÄ app.py                    # Streamlit UI
 ‚îú‚îÄ‚îÄ requirements.txt          # Python deps
 ‚îî‚îÄ‚îÄ games_sample.csv          # optional demo CSV
def run_pipeline(hist_df, stats=["passing_yards","rushing_yards","receiving_yards"]):
    base, frames = build_features(hist_df, stats)
    models = {}
    for stat in stats:
        if stat not in frames:
            continue
        train_df = frames[stat].merge(base, on=["player", "date"], how="left")
        model, resid_std = train_model_per_stat(train_df, stat)
        models[stat] = (model, resid_std)

    pp = fetch_prizepicks_projections()

    latest_by_player = {}
    for stat in stats:
        if stat not in frames:
            continue
        g = frames[stat]
        latest = g.sort_values(["player", "date"]).groupby("player").tail(1)
        latest_by_player[stat] = latest

    rows = []
    for _, row in pp.iterrows():
        stat_key = row["stat_key"]
        if stat_key not in models:
            continue
        model, resid_std = models[stat_key]
        latest = latest_by_player[stat_key]
        pl = latest[latest["player"] == row["player"]]
        if pl.empty:
            continue
        feature_cols = [c for c in pl.columns if c.startswith(stat_key + "_") or c == "games_played"]
        X_inf = pl[feature_cols].fillna(0.0)
        pred = float(model.predict(X_inf)[0])
        prob_over, edge = compute_edge(pred, float(row["line"]), resid_std, "more")
        rows.append({
            "player": row["player"],
            "label": row["label"],
            "line": float(row["line"]),
            "prediction": pred,
            "edge": edge,
            "prob_more": prob_over,
        })

    return pd.DataFrame(rows).sort_values("edge", ascending=False)
import streamlit as st
import pandas as pd
from prizepicks_predictor import run_pipeline

st.set_page_config(page_title="PrizePicks Predictor", layout="wide")

st.title("üèà PrizePicks NFL Prop Predictor")
st.write("Upload your historical player stats CSV to generate predictions.")

# File upload
uploaded_file = st.file_uploader("Upload CSV", type=["csv"])

# Stat selection
default_stats = ["passing_yards", "rushing_yards", "receiving_yards"]
stats = st.multiselect(
    "Choose which stats to model:",
    default_stats,
    default=default_stats
)

if uploaded_file is not None:
    hist = pd.read_csv(uploaded_file)

    with st.spinner("Training models and fetching PrizePicks lines..."):
        predictions = run_pipeline(hist, stats)

    st.success(f"Generated {len(predictions)} predictions.")

    st.dataframe(predictions, use_container_width=True)

    # Download button
    csv = predictions.to_csv(index=False).encode("utf-8")
    st.download_button(
        "Download Predictions CSV",
        csv,
        "predictions.csv",
        "text/csv",
        key="download-csv"
    )
else:
    st.info("üëÜ Upload a CSV to get started.")

